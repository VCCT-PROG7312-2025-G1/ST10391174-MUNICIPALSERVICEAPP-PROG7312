@model MunicipalServiceApp_PROG7312.Models.EventSearchViewModel

@{
    ViewBag.Title = "Local Events & Announcements - POE Part 2";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<!-- Hero Section -->
<div class="hero-section" style="padding: 4rem 0;">
    <div class="container hero-content">
        <h1 class="hero-title" style="font-size: 2.5rem;">Local Events & Announcements</h1>
        <p class="hero-subtitle">
            Stay informed about community events and municipal announcements
        </p>
        <small class="text-white-50 d-block mt-3">
            <i class="fas fa-database me-2"></i>Part 2: Advanced Data Structures Implementation
        </small>
    </div>
</div>

<div class="container py-5">
    <!-- POE Data Structures Banner -->
    <div class="alert alert-info mb-4 slide-up" role="alert">
        <div class="row align-items-center">
            <div class="col-md-8">
                <h6 class="alert-heading mb-2">
                    <i class="fas fa-code me-2"></i>Data Structures Implemented
                </h6>
                <div class="d-flex flex-wrap gap-2">
                    <span class="badge bg-primary">Dictionary</span>
                    <span class="badge bg-success">SortedDictionary</span>
                    <span class="badge bg-warning text-dark">HashSet</span>
                    <span class="badge bg-danger">Queue (FIFO)</span>
                    <span class="badge bg-info">Stack (LIFO)</span>
                    <span class="badge bg-secondary">PriorityQueue</span>
                </div>
            </div>
            <div class="col-md-4 text-end">
                <button class="btn btn-sm btn-outline-primary" onclick="showDataStructuresInfo()">
                    <i class="fas fa-info-circle me-1"></i>Learn More
                </button>
            </div>
        </div>
    </div>

    <!-- Search and Filter Section -->
    <div class="card card-custom mb-4 slide-up">
        <div class="card-header bg-primary text-white">
            <h5 class="mb-0">
                <i class="fas fa-search me-2"></i>Search & Filter Events
            </h5>
        </div>
        <div class="card-body">
            @using (Html.BeginForm("LocalEvents", "Home", FormMethod.Get, new { @id = "eventSearchForm" }))
            {
                <div class="row g-3">
                    <!-- Search Query -->
                    <div class="col-md-4">
                        <label class="form-label fw-bold">
                            <i class="fas fa-search me-1"></i>Search Keywords
                        </label>
                        @Html.TextBox("searchQuery", Model.SearchQuery, new { 
                            @class = "form-control form-control-custom", 
                            @placeholder = "Search events, locations, or tags...",
                            @id = "searchQueryInput"
                        })
                        <small class="text-muted">
                            <i class="fas fa-lightbulb me-1"></i>Try: water, community, safety
                        </small>
                    </div>

                    <!-- Category Filter -->
                    <div class="col-md-3">
                        <label class="form-label fw-bold">
                            <i class="fas fa-filter me-1"></i>Category
                        </label>
                        @Html.DropDownList("category", 
                            new SelectList(Model.Categories), 
                            "All Categories", 
                            new { 
                                @class = "form-select form-control-custom",
                                @id = "categoryFilter"
                            })
                        <small class="text-muted">
                            <i class="fas fa-hashtag me-1"></i>@Model.Statistics.UniqueCategories unique categories
                        </small>
                    </div>

                    <!-- Date Filter -->
                    <div class="col-md-3">
                        <label class="form-label fw-bold">
                            <i class="fas fa-calendar me-1"></i>From Date
                        </label>
                        @Html.TextBox("startDate", 
                            Model.StartDate?.ToString("yyyy-MM-dd"), 
                            new { 
                                @class = "form-control form-control-custom", 
                                @type = "date",
                                @id = "startDateFilter"
                            })
                    </div>

                    <!-- Search Button -->
                    <div class="col-md-2 d-flex align-items-end">
                        <button type="submit" class="btn btn-primary-custom w-100">
                            <i class="fas fa-search me-2"></i>Search
                        </button>
                    </div>
                </div>

                <!-- Recent Searches (Queue Demo) -->
                @if (Model.RecentSearches.Count > 0)
                {
                    <div class="mt-3 pt-3 border-top">
                        <small class="text-muted fw-bold">
                            <i class="fas fa-history me-1"></i>Recent Searches (Queue - FIFO):
                        </small>
                        <div class="d-flex flex-wrap gap-2 mt-2">
                            @foreach (var search in Model.RecentSearches.Take(5))
                            {
                                <button type="button" 
                                        class="btn btn-sm btn-outline-secondary" 
                                        onclick="applyRecentSearch('@search')">
                                    <i class="fas fa-clock me-1"></i>@search
                                </button>
                            }
                        </div>
                    </div>
                }
            }
        </div>
    </div>

    <div class="row">
        <!-- Main Events List -->
        <div class="col-lg-8">
            <!-- Statistics Bar -->
            <div class="card mb-3 slide-up">
                <div class="card-body py-2">
                    <div class="row text-center">
                        <div class="col-md-3">
                            <small class="text-muted">Total Events</small>
                            <h6 class="mb-0 text-primary">@Model.TotalEvents</h6>
                        </div>
                        <div class="col-md-3">
                            <small class="text-muted">Filtered</small>
                            <h6 class="mb-0 text-success">@Model.FilteredEvents</h6>
                        </div>
                        <div class="col-md-3">
                            <small class="text-muted">Categories</small>
                            <h6 class="mb-0 text-info">@Model.Statistics.UniqueCategories</h6>
                        </div>
                        <div class="col-md-3">
                            <small class="text-muted">Total Searches</small>
                            <h6 class="mb-0 text-warning">@Model.Statistics.TotalSearches</h6>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Events by Date (SortedDictionary Demo) -->
            @if (Model.EventsByDate.Any())
            {
                <h5 class="mb-3">
                    <i class="fas fa-calendar-check me-2 text-primary"></i>
                    Events Organized by Date (SortedDictionary)
                </h5>

                @foreach (var dateGroup in Model.EventsByDate)
                {
                    <div class="mb-4 slide-up">
                        <div class="date-header mb-3">
                            <h6 class="text-primary">
                                <i class="fas fa-calendar-day me-2"></i>
                                @dateGroup.Key.ToString("dddd, MMMM dd, yyyy")
                                <span class="badge bg-secondary ms-2">@dateGroup.Value.Count event(s)</span>
                            </h6>
                        </div>

                        @foreach (var evt in dateGroup.Value)
                        {
                            <div class="card card-custom mb-3 event-card">
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-9">
                                            <div class="d-flex align-items-start">
                                                @if (evt.IsFeatured)
                                                {
                                                    <span class="badge bg-warning text-dark me-2">
                                                        <i class="fas fa-star me-1"></i>Featured
                                                    </span>
                                                }
                                                <div>
                                                    <h5 class="card-title mb-2">@evt.Title</h5>
                                                    <p class="card-text text-muted mb-2">@evt.Description</p>
                                                    
                                                    <div class="event-meta">
                                                        <small class="me-3">
                                                            <i class="fas fa-map-marker-alt text-danger me-1"></i>
                                                            @evt.Location
                                                        </small>
                                                        <small class="me-3">
                                                            <i class="fas fa-clock text-primary me-1"></i>
                                                            @evt.EventDate.ToString("HH:mm")
                                                        </small>
                                                        <small>
                                                            <i class="fas fa-users text-success me-1"></i>
                                                            @evt.AttendeeCount attendees
                                                        </small>
                                                    </div>

                                                    <!-- Tags (HashSet Demo) -->
                                                    @if (evt.Tags.Any())
                                                    {
                                                        <div class="mt-2">
                                                            @foreach (var tag in evt.Tags)
                                                            {
                                                                <span class="badge bg-light text-dark me-1">
                                                                    <i class="fas fa-tag me-1"></i>@tag
                                                                </span>
                                                            }
                                                        </div>
                                                    }
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-3 text-end">
                                            <span class="badge bg-primary mb-2 d-block">@evt.Category</span>
                                            <small class="text-muted d-block mb-2">
                                                Priority: @evt.Priority
                                            </small>
                                            <button class="btn btn-sm btn-outline-primary" 
                                                    onclick="viewEventDetails('@evt.EventId')">
                                                <i class="fas fa-info-circle me-1"></i>Details
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                }
            }
            else
            {
                <div class="alert alert-warning" role="alert">
                    <h6><i class="fas fa-exclamation-triangle me-2"></i>No Events Found</h6>
                    <p class="mb-0">
                        No events match your search criteria. Try adjusting your filters or search terms.
                    </p>
                </div>
            }
        </div>

        <!-- Sidebar: Recommendations -->
        <div class="col-lg-4">
            <!-- Recommended Events (30 marks) -->
            <div class="card card-custom mb-4 slide-up">
                <div class="card-header bg-success text-white">
                    <h6 class="mb-0">
                        <i class="fas fa-magic me-2"></i>Recommended for You
                    </h6>
                    <small>Based on search patterns & preferences</small>
                </div>
                <div class="card-body" id="recommendationsContainer">
                    @if (Model.RecommendedEvents.Any())
                    {
                        @foreach (var evt in Model.RecommendedEvents.Take(6))
                        {
                            <div class="recommendation-item mb-3 p-2 border rounded">
                                <div class="d-flex justify-content-between align-items-start">
                                    <div>
                                        <h6 class="mb-1">@evt.Title</h6>
                                        <small class="text-muted d-block">
                                            <i class="fas fa-calendar me-1"></i>
                                            @evt.EventDate.ToString("MMM dd, HH:mm")
                                        </small>
                                        <small class="text-muted d-block">
                                            <i class="fas fa-map-marker-alt me-1"></i>
                                            @evt.Location
                                        </small>
                                    </div>
                                    @if (evt.IsFeatured)
                                    {
                                        <i class="fas fa-star text-warning"></i>
                                    }
                                </div>
                            </div>
                        }
                    }
                    else
                    {
                        <p class="text-muted text-center mb-0">
                            <i class="fas fa-info-circle me-1"></i>
                            Start searching to get personalized recommendations!
                        </p>
                    }
                </div>
            </div>

            <!-- Popular Categories -->
            <div class="card card-custom mb-4 slide-up">
                <div class="card-header bg-info text-white">
                    <h6 class="mb-0">
                        <i class="fas fa-chart-pie me-2"></i>Popular Categories
                    </h6>
                </div>
                <div class="card-body">
                    @if (Model.Statistics.CategoryFrequency.Any())
                    {
                        <div class="list-group list-group-flush">
                            @foreach (var cat in Model.Statistics.CategoryFrequency.OrderByDescending(c => c.Value).Take(5))
                            {
                                <a href="@Url.Action("LocalEvents", new { category = cat.Key })" 
                                   class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                                    @cat.Key
                                    <span class="badge bg-primary rounded-pill">@cat.Value</span>
                                </a>
                            }
                        </div>
                    }
                    else
                    {
                        <p class="text-muted mb-0">No search data yet</p>
                    }
                </div>
            </div>

            <!-- Data Structures Info -->
            <div class="card card-custom slide-up">
                <div class="card-header bg-secondary text-white">
                    <h6 class="mb-0">
                        <i class="fas fa-database me-2"></i>Implementation Details
                    </h6>
                </div>
                <div class="card-body">
                    <small>
                        <ul class="mb-0">
                            <li><strong>Dictionary:</strong> Event lookup (O(1))</li>
                            <li><strong>SortedDictionary:</strong> Date organization</li>
                            <li><strong>HashSet:</strong> Unique categories & tags</li>
                            <li><strong>Queue:</strong> Recent searches (FIFO)</li>
                            <li><strong>Stack:</strong> Search history (LIFO)</li>
                            <li><strong>PriorityQueue:</strong> Featured events</li>
                        </ul>
                    </small>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .event-card {
        transition: all 0.3s ease;
    }

    .event-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 30px rgba(0,0,0,0.15);
    }

    .date-header {
        border-left: 4px solid var(--primary-color);
        padding-left: 1rem;
        background: linear-gradient(90deg, rgba(25,118,210,0.1), transparent);
    }

    .recommendation-item {
        transition: all 0.3s ease;
        cursor: pointer;
    }

    .recommendation-item:hover {
        background: #f8f9fa;
        border-color: var(--primary-color) !important;
    }

    .event-meta small {
        display: inline-block;
    }
</style>

@section scripts {
    <script>
        // Set page-specific variables for site.js
        var isLocalEventsPage = true;
        var searchRecommendationsUrl = '@Url.Action("GetEventRecommendations", "Home")';
        var trackSearchUrl = '@Url.Action("TrackSearch", "Home")';
    </script>
    <script src="~/js/events.js"></script>
}